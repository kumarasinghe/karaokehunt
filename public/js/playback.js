function queryURLParam(e){for(var t=window.location.search.substring(1).split("&"),o=0;o<t.length;o++){var a=t[o].split("=");if(a[0]==e)return a[1]}}function httpRequest(e,t,o){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&200==this.status&&t(a.response)},a.open("GET",e,!0),o&&(a.responseType="arraybuffer"),a.send()}let idList=queryURLParam("id").split("|");if(2!=idList.length)throw alert("Invalid karaoke session. This session does not exist!"),new Error("Invalid karaoke session. This session does not exist!");let videoPlayer,youtubeURL="https://www.youtube.com/embed/"+idList[0]+"?enablejsapi=1&html5=1&modestbranding=1&autohide=2",voiceTrackURL="/voices/"+idList[0]+"/"+idList[1];document.getElementById("video").src=youtubeURL,window.onYouTubePlayerAPIReady=function(){console.log("Youtube Player Ready!"),videoPlayer=new YT.Player("video")};let sourceNode,gainNode,audioContext=new AudioContext;function updateVoiceGain(){try{let e=document.getElementById("volumeSlider").value;gainNode.gain.value=e}catch(e){}}function playStop(){if(1!=videoPlayer.isPlaying){videoPlayer.playVideo(),videoPlayer.isPlaying=!0,document.getElementById("btnPlayStop").value="Stop",document.getElementById("btnPlayStop").style.background="red";let e=setInterval(()=>{videoPlayer.getCurrentTime()>0&&(clearInterval(e),sourceNode.start(),console.log("Playback started!"))},100)}else videoPlayer.isPlaying=!1,videoPlayer.stopVideo(),sourceNode.stop(),document.getElementById("btnPlayStop").value="Play",document.getElementById("btnPlayStop").style.background="#4CBB17",console.log("Playback stopped!")}httpRequest(voiceTrackURL,e=>{audioContext.decodeAudioData(e,e=>{(sourceNode=audioContext.createBufferSource()).buffer=e,(gainNode=audioContext.createGain()).gain.value=GAIN_PLAYBACK,sourceNode.connect(gainNode),gainNode.connect(audioContext.destination)},e=>{console.error("Error with decoding audio data"+e.err)})},!0);
